<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
	PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
	"http://mybatis.org/dtd/mybatis-3-mapper.dtd" >	

<mapper namespace="funfun.repository.MainRepo">
	
	<resultMap type="int" id="cnt"></resultMap>
	<select id="verifyId" resultMap="cnt" parameterType="funfun.vo.MemberLogin">
	
 	select count(*) cnt from member where mem_email=#{mem_email} and mem_pw=#{mem_pw}
	
	</select>
	
	<resultMap type="funfun.vo.MemberInfo" id="memberInfo"></resultMap>
	<select id="getMemberInfo" resultMap="memberInfo" parameterType="String">
		select mem_code, mem_email, mem_name, mem_profile from member where mem_email=#{email}
	</select>
	
	
	<select id="signupIdCheck" resultMap="cnt" parameterType="String">
 	select count(*) cnt from member where mem_email=#{mem_email}
	</select>
	
	<insert id="insertMember" parameterType="funfun.vo.MemberInfo">
		insert into member(mem_code, mem_email, mem_pw, mem_name, mem_favor) values(member_seq.nextval, #{mem_email},
			#{mem_pw}, #{mem_name}, #{mem_favor})
	</insert>
	
	<update id="changePass" parameterType="funfun.vo.MemberInfo">
		update member set mem_pw = #{mem_pw} where mem_email=#{mem_email}
	</update>
	
	<select id="isMaker" parameterType="int" resultType="int">
		select count(*) from maker where mem_code = #{code}
	</select>
	
	<select id="getMakerCode" parameterType="int" resultType="int">
		select maker_code from maker where mem_code = #{code}
	</select>
	
	<select id="getNameByEmail" parameterType="String" resultType="String">
		select mem_name from member where mem_email=#{email}
	</select>
	
	<resultMap type="java.lang.Integer" id="IntegerArray"></resultMap>
	<select id="getFavorCodeListByEmail" parameterType="String" resultMap="IntegerArray">
		select pro_code from favor
	</select>
	
	<select id="getFavorByCode" parameterType="java.lang.Integer" resultType="funfun.vo.Favor">
		SELECT pro_title proTitle, cate_title cateTitle,
		pro_finish_date-current_date dDay, PRO_IMAGE image FROM project WHERE pro_code=#{code}
	</select>
	
	<select id="getBalanceByEmail" parameterType="String" resultType="int">
		SELECT mem_balance FROM member where mem_email=#{email}
	</select>
	
	<select id="getMemCodeByEmail" parameterType="String" resultType="int">
		SELECT mem_code FROM MEMBER WHERE mem_email=#{email}
	</select>
	
	<select id="getUsedByMemCode" parameterType="int" resultType="int">
		SELECT nvl(sum(fund_price* fund_cnt), 0) FROM FUNDING WHERE mem_code=#{code}
	</select>
	
	<resultMap type="funfun.vo.OptCodeAndCnt" id="optCodeAndCnt"></resultMap>
	<select id="getOptCodeAndCntByMemCode" parameterType="int" resultMap="optCodeAndCnt">
		SELECT opt_code optionCode, fund_cnt cnt FROM funding WHERE mem_code=#{mem_code}
	</select>
	
	<select id="getOptionInfoByOptCode" parameterType="int" resultType="funfun.vo.MyFundingInfo">
		SELECT b.pro_title title, a.opt_detail option0, a.opt_price unitPrice
		FROM PRO_OPTION a, project b  WHERE a.opt_code=#{opt_code} AND b.PRO_CODE=a.PRO_CODE
	</select>
</mapper>